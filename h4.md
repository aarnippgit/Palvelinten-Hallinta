# h4 Pkg-file-service

## x) Lue ja tiivistä.

### Pkg-File-Service – Control Daemons with Salt – Change SSH Server Port

-Luo SSH tila ja pääkopio SSH:n määritystiedostosta Masterilla

-Aja tila Slaveille

-Testaa

## Ympäristö:

* Host OS: Windows 11 Home 24H2 26100.6584
* VirtualBox 7.2.2
* Debian 13 Trixie
* Base Memory: 4000 MB
* Processors: 2
* Storage: 60 GB

## a) SSHouto. Lisää uusi portti, jossa SSHd kuuntelee.

Tein tehtävän edellisen viikon Vagrantissa luodulla koneparilla k1(Master) ja k2(Slave).

Alkuun lisäsin molemmilla koneilla tiedostoon /etc/ssh/sshd_config portin 8888.

<img width="435" height="349" alt="k1_k2_portti_8888_auki" src="https://github.com/user-attachments/assets/812176be-85d6-48a6-81c2-3ad7dcaac616" />

Kokeilin kuunteleeko portti:


<img width="497" height="38" alt="Ei_avainta_mutta_kuuntelee" src="https://github.com/user-attachments/assets/71639c07-5c6e-4b05-8d27-c9d23d5b02d8" />

Avainta ei ole mutta kuuntelee.

Seuraavaksi kopioin aikaisemman muokkaamani sshd_configin salt-kansioon, loin kansion /srv/salt/ssh/ ja sen sisään sls-tiedoston.

<img width="346" height="221" alt="ssh_sls" src="https://github.com/user-attachments/assets/302de617-81f2-45d8-ba3a-d9513fa9087d" />

Tämän jälkeen ajoin tilan Slavelle.

<img width="851" height="720" alt="k2_muutoksia" src="https://github.com/user-attachments/assets/bb4593d3-47bb-48df-969c-b18915c99b52" />
<img width="290" height="358" alt="k2_muutoksia_2" src="https://github.com/user-attachments/assets/68d71e99-df08-414d-8d80-b819ff3a1535" />

Testataan vielä poistamalla openssh-server Slavelta ja ajamalla tilan uudestaan:

<img width="704" height="218" alt="openssh-server_asentui uudelleen" src="https://github.com/user-attachments/assets/dfc04d8e-d51b-49b1-ad7b-9e12cc5d0cd0" />
<img width="307" height="360" alt="openssh-server_asentui uudelleen_2" src="https://github.com/user-attachments/assets/1bb53604-1df6-4ce2-af35-46e88d31520e" />

Ja lopuksi vielä testasin että portti kuuntelee yhä:


<img width="497" height="37" alt="taas_auki_ei_avainta" src="https://github.com/user-attachments/assets/56bc5fe5-f511-4c4e-9159-c70285bf2031" />


## Lähteet

[https://terokarvinen.com/palvelinten-hallinta/#h4-pkg-file-service]

[https://terokarvinen.com/2018/04/03/pkg-file-service-control-daemons-with-salt-change-ssh-server-port/?fromSearch=karvinen%20salt%20ssh]
