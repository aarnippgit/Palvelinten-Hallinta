# h6 Miniprojekti

Tein projektini yhdessä [Miro Johanssonin](https://github.com/mk-tali) kanssa. Suunnitelma oli automatisoida TeamSpeak 3 -palvelimen asennus Saltin avulla.


## Kokeiluvaihe

Aloitimme testailemalla manuaalista asennusta. Tein omani Vagrant-virtuaalikoneella. Tein Vagrantfilen joka luo kaksi konetta, masterin ja slave/palvelinkoneen.


<img width="837" height="997" alt="Vagrantfile_kaks_konetta" src="https://github.com/user-attachments/assets/711cae20-062e-45ec-baab-b48830332c06" />


Tässä kohtaa käytin vain palvelinkonetta testatakseni täysin normaalia asennusta:
Asensin ufw:n, lisäsin käyttäjän "teamspeak" ja annoin sille salasanan, jonka jälkeen vaihdoin uudelle käyttäjälle ja siirryin sen kotihakemistoon. Tämän jälkeen latasin wgetilla uusimman [ts3-palvelimen](https://www.teamspeak.com/en/downloads/#server), tässä tapauksessa Linux 64-bit 3.13.7.
Poistuin käyttäjältä ja asensin ohjelman lbzip2 ladatun tiedoston purkamista varten. Ideaalisti sen olisi asentanut etukäteen ylimääräisen poukkoilun välttämiseksi. Siirryin takaisin vaihdoin taas teamspeakille, purin tiedoston ja kopioin sen sisällöt kotihakemistoon.
```
teamspeak$ tar -xf teamspeak3-server_linux_amd64-3.13.7.tar.bz2
teamspeak$ cd teamspeak3-server_linux_amd64
teamspeak$ cp * -R /home/teamspeak
```
Loin vielä ".ts3server_license_accepted"-tiedoston hyväksyäkseni lisenssin ja poistuin käyttäjältä.
```
teamspeak$ touch .ts3server_license_accepted
```
Tämän jälkeen loin tiedoston ts3server.service,
```
$ sudo nano /lib/systemd/system/ts3server.service

[Unit]
Description=Teamspeak Service
Wants=network.target

[Service]
WorkingDirectory=/home/teamspeak
User=teamspeak
ExecStart=/home/teamspeak/ts3server_minimal_runscript.sh
ExecStop=/home/teamspeak/ts3server_startscript.sh stop
ExecReload=/home/teamspeak/ts3server_startscript.sh restart
Restart=always
RestartSec=15

[Install]
WantedBy=multi-user.target
```
Wants=network.target - Pyrkii käynnistymään vasta kun network on päällä
ExecStart/ExecStop/ExecReload - Skriptit jotka käynnistävät, sammuttavat ja uudelleenkäynnistävät teamspeak-palvelimen

Tämän jälkeen käynnistin ja enablesin ts3serverin ja otin talteen sen generoiman salasanan ja admin-tokenin.
```
$ sudo journalctl -xe -u ts3server | grep password
$ sudo journalctl -xe -u ts3server | grep token
```
Lopuksi vielä avasin ufw:n portit 9987/udp, 30033/tcp, 10011/tcp ja 41144/tcp

Servu käynnissä:

<img width="1103" height="400" alt="eka_servukokeilu_käynnissä" src="https://github.com/user-attachments/assets/62bdb273-443d-4bbd-a9be-316737296f87" />

Yhdistin hostikoneella clientillä testiksi:

<img width="567" height="88" alt="tessuservu_skulaa" src="https://github.com/user-attachments/assets/7573cbee-62a2-48de-848f-9486dd2c939a" />


## Mites tää automatisoidaan?






## Lähteet:


https://www.transip.eu/knowledgebase/3346-installing-teamspeak-server-in-linux

https://www.digitalocean.com/community/tutorials/understanding-systemd-units-and-unit-files
