## Karvinen 2025: Install Salt on Debian 13 Trixie

Asennetaan uusi apt repositorio automaattisia päivityksiä varten. Koostuu kahdesta tiedostosta: PGP public key ja sources.list. 

Alkuun asennetaan wget: 
$ sudo apt-get update
$ sudo apt-get install wget

Luodaan uusi hakemisto saltrepo/ 
$ mkdir saltrepo/
$ cd saltrepo/

ja ladataan sinne halutut tiedostot.
$ wget https://packages.broadcom.com/artifactory/api/security/keypair/SaltProjectKey/public
$ wget https://github.com/saltstack/salt-install-guide/releases/latest/download/salt.sources

Lisätään avain:
	$ sudo cp public /etc/apt/keyrings/salt-archive-keyring.pgp
	$ sudo cp salt.sources /etc/apt/sources.list.d/

Asennetaan Salt:
	$ sudo apt-get update
	$ sudo apt-get install salt-minion salt-master

Testataan:
	$ salt --version
	salt 3007.8 (Chlorine)

	$ sudo salt-call --local state.single file.managed /tmp/hellotero
		file /tmp/hellotero created

	$ ls /tmp/hellotero 
	/tmp/hellotero	
	
Asennus onnistui.



## Karvinen 2023: Run Salt Command Locally

Tärkeimmät funktiot:
pkg
file
service
user 
cmd

Asenna Salt orja (Debian/Ubuntu):
	$ sudo apt-get update
	$ sudo apt-get -y install salt-minion

Löytyykö?
	$ sudo salt-call --version

pkg.installed - applikaatio tulisi asentaa
	$ sudo salt-call --local -l info state.single pkg.installed tree

	$ sudo salt-call --local -l info state.single pkg.removed tree

file.managed - Tulisi olla tiedosto
	$ sudo salt-call --local -l info state.single file.managed /tmp/hellotero

	$ sudo salt-call --local -l info state.single file.managed /tmp/moitero contents="foo"

	$ sudo salt-call --local -l info state.single file.absent /tmp/hellotero

service.running - daemon on käynnissä
Käytetään automaattisesti uudelleenkäynnistämään daemoni asetusten muuttamisen jälkeen.
	$ sudo salt-call --local -l info state.single service.running apache2 enable=True

	$ sudo salt-call --local -l info state.single service.dead apache2 enable=False

user.present - käyttäjän tulisi olla olemassa
	$ sudo salt-call --local -l info state.single user.present terote08

	$ sudo salt-call --local -l info state.single user.absent terote08

cmd.run - komennon suoritus
	$ sudo salt-call --local -l info state.single cmd.run 'touch /tmp/foo' creates="/tmp/foo"

pitää olla idempotentti
creates, unless, onlyif

Käyttöohjeet:
	$ sudo salt-call --local sys.state_doc


## Karvinen 2018: Salt Quickstart – Salt Stack Master and Slave on Ubuntu Linux

Asenna Master

	master$ sudo apt-get update
	master$ sudo apt-get -y install salt-master
	master$ hostname -I
	0.0.0.88

Jos masterilla on palomuuri, pitää avata 4505/tcp ja 4506/tcp.

Asenna Slave
	slave$ sudo apt-get update
	slave$ sudo apt-get -y install salt-minion

Orjan pitää tietää masterin sijainti. Sen voi myös nimetä (id) tai nimen voi generoita hostnamesta. Kaikki tarvitsevat uniikin id:n.

	slave$ sudoedit /etc/salt/minion
	master: 10.0.0.88
	id: abc

Orja daemon käynnistetään uudelleen jotta uudet asetukset saadaan käyttöön ja orjan yhdistää masteriin.
	slave$ sudo systemctl restart salt-minion.service

Hyväksytään orjan avain masterilla:
	master$ sudo salt-key -A
	Unaccepted Keys:
	abc
	Proceed? [n/Y]
	Key for minion abc accepted.

Kokeillaan:
	master$ sudo salt '*' cmd.run 'whoami'
	abc:
 	root

Jos orja vastaa, homma toimii.

Komentoja kokeiltavaksi:
	master$ sudo salt '*' cmd.run 'hostname -I'
	master$ sudo salt '*' grains.items|less
	master$ sudo salt '*' grains.items
	master$ sudo salt '*' grains.item virtual
	master$ sudo salt '*' pkg.install httpie
	master$ sudo salt '*' sys.doc|less

  
## Karvinen 2006: Raportin kirjoittaminen
Raportin kirjoittaminen

-Kerro mitä teit ja mitä tapahtui
-Kirjoita samalla kun teet
-Raportin avulla tulee toisen ihmisen kyetä luomaan samat tulokset

Raportoi:
Ympäristö (missä, millä, koska)
Komennot
Klikit
Kellonajat
Onnistumiset ja epäonnistumiset (Mitä tapahtui, miten totesit tämän)
Työkalujen viat (virheraportit)
Odottamattomat tulokset

-Jos (koulun) työkaluissa vikaa, ota yhteys Juhani Ahlgreniin

-Kirjoita menneessä muodossa
-Käytä väliotsikoita
-Kirjoita huolellisesti
-Kirjoita yhden kappaleen tiivistelmä alkuun (jos haluat)
-Viittaa lähteisiin


> “Tätä dokumenttia saa kopioida ja muokata GNU General Public License (versio 2 tai uudempi) mukaisesti. http://www.gnu.org/licenses/gpl.html”
> “Pohjana Tero Karvinen 2012: Linux kurssi, http://terokarvinen.com”


ÄLÄ:
-Sepitä
-Plagioi
-Kopioi kuvia luvatta

-Luvallisia kuvia käytettäessä ilmoita lähde.


## lähteet
https://terokarvinen.com/install-salt-on-debian-13-trixie/
https://terokarvinen.com/2021/salt-run-command-locally/
https://terokarvinen.com/2018/03/28/salt-quickstart-salt-stack-master-and-slave-on-ubuntu-linux/
https://terokarvinen.com/2006/06/04/raportin-kirjoittaminen-4/
https://terokarvinen.com/palvelinten-hallinta/
